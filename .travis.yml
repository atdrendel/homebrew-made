# only run for: merge commits, releases and pull-requests
if: type != push OR branch = master OR branch =~ /^\d+\.\d+(\.\d+)?(-\S*)?$/

jobs:
  include:
    - &macOS
      os: osx
      osx_image: xcode10.1
      name: macOS / Swift 4.2.1
      script: brew install ./swift-sh.rb

    - <<: *macOS
      name: macOS / Swift 5.0.x
      osx_image: xcode10.2

    - &linux
      name: Linux / Swift 4.2.4
      os: linux
      env: SWIFT_VERSION=4.2.4
      before_install: |
        curl "https://swift.org/builds/swift-$SWIFT_VERSION-release/ubuntu1604/swift-$SWIFT_VERSION-RELEASE/swift-$SWIFT_VERSION-RELEASE-ubuntu16.04.tar.gz" | sudo tar xz -C / --strip-components=1
      install: |
        sudo apt-get install clang libicu-dev
      before_script: |
        sh -c "$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install.sh)"
      script: |
        /home/linuxbrew/.linuxbrew/bin/brew install ./swift-sh.rb --verbose

    - <<: *linux
      name: Linux / Swift 5.0.0
      env: SWIFT_VERSION=5.0
      